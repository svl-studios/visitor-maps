!function(i){"use strict";i.visitorMaps=i.visitorMaps||{},i(document).ready(function(){i.visitorMaps.init(),i.visitorMaps.switchClick(),i.visitorMaps.mapConsoleClick(),i.visitorMaps.whoIsClick(),i.visitorMaps.pageNavClick()}),i.visitorMaps.init=function(){var e,r,t="",a=1,o=i(".visitor-map-actions").data("nonce");if(i(".visitor-map-actions").after('<form id="vm_form" action="'+window.location.href+'" method="post"><input type="hidden" name="vm_mode_nonce" value="'+o+'"><input type="hidden" name="vm_mode" id="vm_mode" value="" /><input type="hidden" name="vm_ip" id="vm_ip" value="" /><input type="hidden" name="vm_referer" id="vm_referer" value="" /></form>'),vmMessage&&(i("#vm_form").after('<div class="updated" style="padding:10px 4px">'+vmMessage+"</div>"),htaccessWarning||i(".updated").delay(5e3).hide("slow")),t+='<br /><a href="#" class="vm-auto-update-form-container-toggle" title="Toggle to view or edit auto-update settings">+ Automatic Update</a> (',vmAutoUpdate?t+="On":t+="Off",t+=') <div class="vm-auto-update-form-container" style="padding:10px 4px;display:none;"><form id="vm_auto_update_form" action="'+window.location.href+'" method="post"><input type="hidden" name="vm_mode_nonce" value="'+o+'"><input type="hidden" name="vm_mode" id="vm_mode" value="set auto update" />',t+='Auto-update <select title="Automatically refresh the Who\'s Been Online grid?" size="1" name="vm_auto_update" id="vm_auto_update"><option value="false"',vmAutoUpdate||(t+=' selected="selected"'),t+='>Off</option><option value="true"',vmAutoUpdate&&(t+=' selected="selected"'),t+='>On</option></select><br />Refresh grid every <input type="number" min="1" value="'+vmAutoUpdateTime+'" name="vm_auto_update_time" style="width:50px;" title="Enter a number no less than 1" required="required" /> minute(s).<br /><button type="submit" class="vm_auto_update button-primary" data-mode="set auto update" title="Update settings"  style="cursor:pointer;">Update Settings</button><span class="vm_refresh_button button-secondary" title="Refresh the Who\'s Been Online grid now." style="cursor:pointer;">Refresh Now</span></form><br />Progress <div class="vm_refresh_status" title="Time remaining" style="width:200px;background-color:#DDDDDD;border:1px solid #C0C0C0;color:#333333;padding:1px;text-decoration:none;-moz-border-radius:10px;-khtml-border-radius:10px;-webkit-border-radius:10px;border-radius:10px;"><div class="vm_refresh_progress" style="width:1%;padding:0px;line-height:10px;color:#F5F5F5;border-right:1px solid #333333;-moz-border-radius:10px;-khtml-border-radius:10px;-webkit-border-radius:10px;border-radius:10px;background:#075698;background:-webkit-gradient(linear, 0 0, 0 100%, from(#E9E9E9), to(#FFFFFF));background:-moz-linear-gradient(#E9E9E9, #FFFFFF);background:-o-linear-gradient(#E9E9E9, #FFFFFF);background:linear-gradient(#E9E9E9, #FFFFFF);">.</div></div></div>',htaccess){for(t+='<br /><a href="#" class="vm-banned-ips-form-container-toggle" title="Toggle to view or edit banned IP addresses">+ Banned IP Addresses</a> ('+(e=""===bannedIps[0]?0:bannedIps.length)+')<div class="vm-banned-ips-form-container" style="padding:10px 4px;display:none;">',0<e&&(t+='<a class="vm_ban_toggle vm_purge" data-ip="000.000.000.000" data-mode="purge" title="Unban all IP addresses." href="javascript:void(0);" style="">Unban All</a>'),t+='<div id="vm_ip_form" style="width:180px; height:80px; overflow:auto; border:1px solid #C0C0C0; background-color: #EFEFEF; padding: 5px;">',a=0;a<e;a++)t+='<a class="vm_ban_toggle" data-ip="'+bannedIps[a]+'" data-mode="unban" title="Unban this IP address" href="javascript:void(0);" style="background-color:#B30000;color:white;padding:0px 4px;text-decoration:none;-moz-border-radius:10px;-khtml-border-radius:10px;-webkit-border-radius:10px;border-radius:10px;">X</a> '+bannedIps[a]+"<br />";for(t+='</div><a class="vm_ban_toggle add_ip" data-ip="" data-mode="ban" title="Ban any IP address" href="javascript:void(0);" style="background-color:#008000;color:white;padding:0px 4px;text-decoration:none;-moz-border-radius:10px;-khtml-border-radius:10px;-webkit-border-radius:10px;border-radius:10px;">X</a> <input type="text" value="" class="ip_to_add" placeholder="New IP Address To Ban" style="width:174px;" /></div>',t+='<br /><a href="#" class="vm-banned-referers-form-container-toggle" title="Toggle to view or edit banned referers">+ Banned Referers</a> ('+(r=""===bannedReferers[0]?0:bannedReferers.length)+')<div class="vm-banned-referers-form-container" style="padding:10px 4px;display:none;">',0<r&&(t+='<a class="vm_ban_referers_toggle vm_purge_referers" data-referer="" data-mode="purge referers" title="Unban all referers." href="javascript:void(0);" style="">Unban All</a>'),t+='<div id="vm_referers_form" style="width:180px; height:80px; overflow:auto; border:1px solid #C0C0C0; background-color: #EFEFEF; padding: 5px;">',a=0;a<r;a++)t+='<a class="vm_ban_referers_toggle" data-referer="'+bannedReferers[a]+'" data-mode="unban referer" title="Unban this referer" href="javascript:void(0);" style="background-color:#B30000;color:white;padding:0px 4px;text-decoration:none;-moz-border-radius:10px;-khtml-border-radius:10px;-webkit-border-radius:10px;border-radius:10px;">X</a> '+bannedReferers[a]+"<br />";t+='</div><a class="vm_ban_referers_toggle add_referer" data-referer="" data-mode="ban referer" title="Ban any referer" href="javascript:void(0);" style="background-color:#008000;color:white;padding:0px 4px;text-decoration:none;-moz-border-radius:10px;-khtml-border-radius:10px;-webkit-border-radius:10px;border-radius:10px;">X</a> <input type="text" value="" class="vm_referer_to_add" placeholder="New Referer To Ban" style="width:174px;" /></div>',i("a.map-console").after(t),i(".vm-banned-ips-form-container-toggle").click(function(){i(".vm-banned-ips-form-container").is(":visible")?(i(".vm-banned-ips-form-container").hide("slow"),i(this).html("+ Banned IP Addresses")):(i(".vm-banned-ips-form-container").show("slow"),i(this).html("- Banned IP Addresses"))}),i(".vm-banned-referers-form-container-toggle").click(function(){i(".vm-banned-referers-form-container").is(":visible")?(i(".vm-banned-referers-form-container").hide("slow"),i(this).html("+ Banned Referers")):(i(".vm-banned-referers-form-container").show("slow"),i(this).html("- Banned Referers"))}),i(".visitor-map-key").append('<tr><td><span style="background-color:#008000;color:white;padding:0px 4px;text-decoration:none;-moz-border-radius:10px;-khtml-border-radius:10px;-webkit-border-radius:10px;border-radius:10px;">X</span> Ban   </td><td><span style="background-color:#B30000;color:white;padding:0px 4px;text-decoration:none;-moz-border-radius:10px;-khtml-border-radius:10px;-webkit-border-radius:10px;border-radius:10px;">X</span> Unban  </td></tr><tr><td><span title="Admin" style="background-color:#D4D4D4;color:white;padding:0px 4px;text-decoration:none;-moz-border-radius:10px;-khtml-border-radius:10px;-webkit-border-radius:10px;border-radius:10px;cursor:pointer;">A</span> Admin   </td><td><span title="Disabled" style="background-color:#D4D4D4;color:white;padding:0px 4px;text-decoration:none;-moz-border-radius:10px;-khtml-border-radius:10px;-webkit-border-radius:10px;border-radius:10px;cursor:pointer;">X</span> Disabled  </td></tr>')}else i("a.map-console").after(t);i(".vm-auto-update-form-container-toggle").click(function(){i(".vm-auto-update-form-container").is(":visible")?(i(".vm-auto-update-form-container").hide("slow"),i(this).html("+ Automatic Update")):(i(".vm-auto-update-form-container").show("slow"),i(this).html("- Automatic Update"))}),i.visitorMaps.refresh(),i.visitorMaps.activateGrid(),i(".visitor-maps-data").wrap('<div id="vm-grid-container"></div>'),vmAutoUpdate&&(o=Math.round(60*parseInt(vmAutoUpdateTime)*1e3),setInterval(i.visitorMaps.reloadGrid,o),i(".vm_refresh_progress").css("width","1%").animate({width:"100%"},o,function(){})),i('small:contains("'+vmPoweredByText+'")').append('. <a href="http://wordpress.org/extend/plugins/visitor-maps-extended-referer-field/" target="_blank">Extended</a> by <a href="http://jasonlau.biz" target="_blank">JasonLau.biz</a>')},i.visitorMaps.refresh=function(){i(document).on("click",".vm_refresh_button",function(e){e.preventDefault(),i("#vm-grid-container").load(window.location.href+' table:contains("'+vmTableSelectorText+'")',function(){i.visitorMaps.reloadGrid();try{console.log("Grid successfully reloaded.")}catch(e){}})})},i.visitorMaps.getHostname=function(e){var r,t="";if(e.split("file:")[1])return"localhost";r=new RegExp("^(?:f|ht)tp(?:s)?://([^/]+)","im");try{t=e.match(r)[1].toString()}catch(e){}return""===t&&(t="Bot"),t},i.visitorMaps.getUrlVars=function(e){var a={};return e.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(e,r,t){a[r]=t}),a},i.visitorMaps.reloadGrid=function(){var e=Math.round(60*parseInt(vmAutoUpdateTime)*1e3);i(".vm_refresh_progress").stop().css("width","1%").animate({width:"100%"},e,function(){}),i("#vm-grid-container").load(window.location.href+' table:contains("'+vmTableSelectorText+'")',function(){i.visitorMaps.activateGrid();try{console.log("Grid successfully reloaded. Reloading in "+vmAutoUpdateTime+" minutes.")}catch(e){}})},i.visitorMaps.activateGrid=function(){var e;i('td[class*="referer"] a').each(function(){var e,r,t=i(this).attr("href"),a=i.visitorMaps.getUrlVars(t).q;!a&&i.visitorMaps.getUrlVars(t).p&&(a=i.visitorMaps.getUrlVars(t).p),t&&(e=i.visitorMaps.getHostname(t).replace(/www./gi,""),a?(a=(r=a).replace(/%20|%2B|\+/gi," ").replace(/%3E|%3C/gi,"").toLowerCase(),i(this).html(e),i(this).after(' <a style="color: green; text-decoration: none;border-bottom: 1px dashed green;" href="https://www.google.com/#hl=en&safe=on&output=search&sclient=psy-ab&q='+r+'" target="_blank" title="Search Google for '+decodeURI(a)+'">'+decodeURI(a)+"</a>")):i(this).html(e),i(this).attr({href:t,title:t}),"localhost"===e&&i(this).replaceWith('<span title="'+t+'" style="background-color:#D4D4D4;color:white;padding:0px 4px;text-decoration:none;-moz-border-radius:10px;-khtml-border-radius:10px;-webkit-border-radius:10px;border-radius:10px;cursor:pointer;">X</span> <span style="color: green; text-decoration: none;border-bottom: 1px dashed green;" title="'+t+'">'+e+"</span>"),htaccess&&(-1!==i.inArray(e,bannedReferers)&&adminHost!==e&&"localhost"!==e?i(this).before('<a class="vm_ban_referers_toggle" data-referer="'+e+'" data-mode="unban referer" title="Unban this referer" href="javascript:void(0);" style="background-color:#B30000;color:white;padding:0px 4px;text-decoration:none;-moz-border-radius:10px;-khtml-border-radius:10px;-webkit-border-radius:10px;border-radius:10px;">X</a> '):adminHost!==e&&"localhost"!==e?i(this).before('<a class="vm_ban_referers_toggle" data-referer="'+e+'" data-mode="ban referer" title="Ban this referer" href="javascript:void(0);" style="background-color:#008000;color:white;padding:0px 4px;text-decoration:none;-moz-border-radius:10px;-khtml-border-radius:10px;-webkit-border-radius:10px;border-radius:10px;">X</a> '):i(this).before('<span title="Home" style="background-color:#D4D4D4;color:white;padding:0px 4px;text-decoration:none;-moz-border-radius:10px;-khtml-border-radius:10px;-webkit-border-radius:10px;border-radius:10px;cursor:pointer;">X</span> ')))}),i('.table-top td:contains("'+refererText+'")').append(" & Search String"),i(".column-dark td:contains(a), .column-light td:contains(a)").each(function(){i(this).wrapInner('<div style="max-width:400px; overflow:hidden; padding:0px; margin:0px"></div>')}),htaccess&&i('a[href*="http://www.ip-adress.com/ip_tracer/"]').each(function(){var e=i(this).attr("href").split("http://www.ip-adress.com/ip_tracer/");(-1!==i.inArray(e[1],bannedIps)||e[1]===vmIp&&"unban"!==mode)&&e[1]!==adminIp?i(this).before('<a class="vm_ban_toggle" data-ip="'+e[1]+'" data-mode="unban" title="Unban this IP address" href="javascript:void(0);" style="background-color:#B30000;color:white;padding:0px 4px;text-decoration:none;-moz-border-radius:10px;-khtml-border-radius:10px;-webkit-border-radius:10px;border-radius:10px;">X</a> '):e[1]!==adminIp?i(this).before('<a class="vm_ban_toggle" data-ip="'+e[1]+'" data-mode="ban" title="Ban this IP address" href="javascript:void(0);" style="background-color:#008000;color:white;padding:0px 4px;text-decoration:none;-moz-border-radius:10px;-khtml-border-radius:10px;-webkit-border-radius:10px;border-radius:10px;">X</a> '):i(this).before('<span title="Admin" style="background-color:#D4D4D4;color:white;padding:0px 4px;text-decoration:none;-moz-border-radius:10px;-khtml-border-radius:10px;-webkit-border-radius:10px;border-radius:10px;cursor:pointer;">A</span> ')}),i(".vm_ban_toggle").on("click",function(){return!(i(this).hasClass("vm_purge")&&!confirm("Are you sure you want to unban ALL of the IP addresses?"))&&(i(this).hasClass("add_ip")?(i("#vm_form input#vm_mode").val("ban"),i("#vm_form input#vm_ip").val(i(".ip_to_add").val())):(i("#vm_form input#vm_mode").val(i(this).data("mode")),i("#vm_form input#vm_ip").val(i(this).data("ip"))),void(i("#vm_form input#vm_ip").val()&&""!==i("#vm_form input#vm_ip").val()?i("#vm_form").submit():alert("Error: No IP address was entered!")))}),i(".vm_ban_referers_toggle").on("click",function(){if(i(this).hasClass("vm_purge_referers")){if(!confirm("Are you sure you want to unban ALL of the referers?"))return!1;i("#vm_form input#vm_mode").val("purge referers"),i("#vm_form input#vm_referer").val("purge referers")}else i(this).hasClass("add_referer")?(i("#vm_form input#vm_mode").val("ban referer"),i("#vm_form input#vm_referer").val(i(".vm_referer_to_add").val())):(i("#vm_form input#vm_mode").val(i(this).data("mode")),i("#vm_form input#vm_referer").val(i(this).data("referer")));i("#vm_form input#vm_referer").val()&&""!==i("#vm_form input#vm_referer").val()?i("#vm_form").submit():alert("Error: No referer was entered!")}),e=i('img[alt="Active Guest"]').not('img[alt="Active Guest"]:first').length-1,i("title").html("("+e+") Who's Been Online")},i.visitorMaps.pageNavClick=function(){i(".visitors-pagination .page-nav").on("click",function(e){var r=i(this).data("pageno");e.preventDefault(),i(".visitor-maps-data #pageno").val(r),document.getElementById("vm_nav").submit()})},i.visitorMaps.whoIsClick=function(){var r=i(".visitor-maps-data a.whois-lookup, a.whois-lookup");r.on("click",function(e){e.preventDefault(),window.open(r.attr("href"),"who_is_lookup","height=650,width=800,toolbar=no,statusbar=no,scrollbars=yes").focus()})},i.visitorMaps.mapConsoleClick=function(){var r=i(".visitor-map-actions a.map-console, a.map-console-bottom");r.on("click",function(e){e.preventDefault(),window.open(r.attr("href"),"wo_map_console","height=650,width=800,toolbar=no,statusbar=no,scrollbars=yes").focus()})},i.visitorMaps.switchClick=function(){i(".redux-main .location-enable .switch-options label").bind("click",function(){i(this).hasClass("cb-enable")?i.visitorMaps.toggleNotices(!0):i(this).hasClass("cb-disable")&&i.visitorMaps.toggleNotices(!1)}),i.visitorMaps.toggleNotices=function(e){var r=i(".redux-main .visitor-maps-geolitecity"),t=Boolean(r.data("update"));!0===e?(r.removeClass("update-message notice-error").addClass("updated-message notice-success"),e=t?visitorMaps.update_notice.update:visitorMaps.update_notice.lookup,r.find("p").html(visitorMaps.update_notice.enable+e+'<span class="lookup-data"></span>'),t?i.visitorMaps.ajax.geoLiteCityUpdate(r):i.visitorMaps.ajax.runLookupTest()):(r.removeClass("updated-message notice-success").addClass("update-message notice-error"),r.find("p").html(visitorMaps.update_notice.disable))}}}(jQuery);